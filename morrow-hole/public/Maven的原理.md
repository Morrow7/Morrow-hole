## Maven的原理

**本质：基于约定的项目构建与依赖管理工具**

### 功能：

**1.项目构建自动化（构建生命周期）**

   *编译、测试、打包、安装本地仓库、部署*

**2.依赖管理**

  *自动下载依赖、自动管理依赖版本、自动解决依赖冲突*



 ### Maven构建过程原理：

**clean、default、site**

Maven会从上到下执行：validate、compile、test、package



![image-20251211210056838](C:\Users\45379\AppData\Roaming\Typora\typora-user-images\image-20251211210056838.png)

**Maven本质上是声明周期（时机）+插件（执行者）的调度系统**



![image-20251211210243090](C:\Users\45379\AppData\Roaming\Typora\typora-user-images\image-20251211210243090.png)

***Maven通过POM+仓库+插件+生命周期，实现了项目构建的自动化，同时通过依赖树+版本管理机制解决了jar包管理的复杂性***



## 详细工作流程

1.解析命令与生命周期选择

2.构建有效POM

3.解析依赖树

4.确定构建顺序

5.生命周期阶段与插件执行

6.构建产物与回本地仓库/远程部署



                   ┌──────────────────────────┐
                   │        开始构建           │
                   └─────────────┬────────────┘
                                 │
                      读取 pom.xml 的依赖声明
                                 │
                                 ▼
                   ┌──────────────────────────┐
                   │  构建 Effective POM（继承）│
                   └─────────────┬────────────┘
                                 │
                                 ▼
                   ┌──────────────────────────┐
                   │   依赖收集（含传递依赖）   │
                   └─────────────┬────────────┘
                                 │
                         对每个依赖执行：
                                 │
                                 ▼
        ┌──────────────────────────────────────────────────┐
        │           本地仓库（~/.m2/repository）是否存在？ │
        └───────────────┬──────────────────────────────────┘
                        │ 是
                        ▼
                 ┌────────────────┐
                 │  使用本地缓存  │
                 └───────┬────────┘
                         │
                         ▼
                 回到上层继续解析其他依赖
                         
                        │ 否
                        ▼
       ┌──────────────────────────────────────────────────┐
       │    按 settings.xml 中的 mirrors / repositories    │
       │       顺序从远程仓库下载（含 POM + JAR）         │
       └──────────────────────┬───────────────────────────┘
                              │
                              ▼
                  ┌──────────────────────────┐
                  │ 校验 SHA1 / MD5 是否正确 │
                  └─────────────┬────────────┘
                                │
                                ▼
                     保存到本地仓库缓存
                                │
                                ▼
                   ┌──────────────────────────┐
                   │ 解析依赖的 POM 继续递归   │
                   │ （传递依赖解析）         │
                   └─────────────┬────────────┘
                                 │
                                 ▼
                      ┌───────────────────────┐
                      │ 冲突解决（Nearest-Wins）│
                      │ 或 dependencyManagement │
                      └───────────────┬───────┘
                                      │
                                      ▼
                          ┌──────────────────────┐
                          │  构建最终依赖树（CT） │
                          └──────────────────────┘





                   ┌──────────────────────────┐
                   │        开始构建           │
                   └─────────────┬────────────┘
                                 │
                      读取 pom.xml 的依赖声明
                                 │
                                 ▼
                   ┌──────────────────────────┐
                   │  构建 Effective POM（继承）│
                   └─────────────┬────────────┘
                                 │
                                 ▼
                   ┌──────────────────────────┐
                   │   依赖收集（含传递依赖）   │
                   └─────────────┬────────────┘
                                 │
                         对每个依赖执行：
                                 │
                                 ▼
        ┌──────────────────────────────────────────────────┐
        │           本地仓库（~/.m2/repository）是否存在？ │
        └───────────────┬──────────────────────────────────┘
                        │ 是
                        ▼
                 ┌────────────────┐
                 │  使用本地缓存  │
                 └───────┬────────┘
                         │
                         ▼
                 回到上层继续解析其他依赖
                         
                        │ 否
                        ▼
       ┌──────────────────────────────────────────────────┐
       │    按 settings.xml 中的 mirrors / repositories    │
       │       顺序从远程仓库下载（含 POM + JAR）         │
       └──────────────────────┬───────────────────────────┘
                              │
                              ▼
                  ┌──────────────────────────┐
                  │ 校验 SHA1 / MD5 是否正确 │
                  └─────────────┬────────────┘
                                │
                                ▼
                     保存到本地仓库缓存
                                │
                                ▼
                   ┌──────────────────────────┐
                   │ 解析依赖的 POM 继续递归   │
                   │ （传递依赖解析）         │
                   └─────────────┬────────────┘
                                 │
                                 ▼
                      ┌───────────────────────┐
                      │ 冲突解决（Nearest-Wins）│
                      │ 或 dependencyManagement │
                      └───────────────┬───────┘
                                      │
                                      ▼
                          ┌──────────────────────┐
                          │  构建最终依赖树（CT） │
                          └──────────────────────┘